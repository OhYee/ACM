---
title: 服务器 SQL 数据库还原
date: 2017-03-17 12:19:01
categories: 笔记
tags:
  - SQL
  - 数据库
keywords: 
  - SQL 2005
  - SQL 2000
  - 工作站组件、联机丛书和开发工具安装失败
  - MDF 还原文件
  - 还原
---
解决了两个问题：
 - [未正常卸载 SQL 2005 的情况下重装 SQL 提示 "**工作站组件、联机丛书和开发工具安装失败**"](#a1)
 - [在只有 MDF 和 LDF 文件情况下还原数据库](#a2)
 <!--more-->
----
客服为了修自己的软件,把另两个公司软件的数据库给搞坏了   
服务器上装有 `SQL 2000` 和 `SQL 2005`  
其中,`SQL 2000` 上装的是网中网公司的软件,`SQL 2005` 则装的是世格和浙科公司的软件  
其中损坏的就是 `SQL 2005` 

首先进入服务器检查文件,可以发现虽然 `SQL 2005` 的程序都没了,但是数据库还在  
因此只要重新安装上数据库文件,还是能够恢复的  

那么就把还存在的数据库文件给复制出来就行  
直接运行 `SQL 2005` 的安装程序,设置成新的实例名,重新安装好理论上就能解决  

到了最后一步,提示安装包出错,安装组件失败  
这就非常尴尬了,由于本来的 `SQL 2005` 不是正常卸载的,所以不知道哪里出了问题  

<div id = "a1"></div>
理论上要解决这个只需要彻底卸载 2005 就行,但是 2005 文件装的很乱,如果想卸载干净还是挺麻烦的(需要自己去清注册表表)  
并且服务器上还有 SQL 2000 ,如果不小心有可能再把 2000 弄坏  
因此应该选择一个更为稳妥的解决方案  

进入到安装光盘,找到 `./Tools/Setup/SqlRun_Tools.msi`    
运行,选择卸载
卸载完成后再运行一次,选上要安装的组件即可  


<div id = "a2"></div>
然后就是重新导入数据库了  
如果有备份的话,直接选择好备份文件然后 **还原** 就行  
如果没有备份,只有 mdf 和 ldf 文件的话,可以选择 **附加数据库** ,或者运行下面的 **查询代码**  

下面是将 `File.mdf` 和 `File_log.ldf` 还原到 `NewFile` 数据库的查询代码  
先把文件拷贝到 SQL 的数据库文件夹里,然后把下面的路径改成你的文件夹路径  
```sql
USE master;
GO
CREATE DATABASE NewFile
ON (FILENAME = 'C:\Program Files\Microsoft SQL Server\90\MSSQL\DATA\File.mdf'),
(FILENAME = 'C:\Program Files\Microsoft SQL Server\90\MSSQL\DATA\File_log.ldf')
FOR ATTACH;
GO
```

以上,就能还原数据库了  